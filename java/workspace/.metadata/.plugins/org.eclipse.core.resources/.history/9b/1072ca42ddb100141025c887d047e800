package com.wilsonflying.testprogressbar;

import android.app.Activity;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.view.View;
import android.widget.HorizontalScrollView;
import android.widget.ProgressBar;
import android.widget.Toast;

public class MainActivity extends Activity {

	private ProgressBar progressH;
	private ProgressBar progressC;
	private Handler mHandler;
	private final int CHANGE_PROGRESS = 100;
	private final int FULL_PROGRESS = 200;
	private int mProgress;

	@Override
	public void onCreate(Bundle param) {
		super.onCreate(param);
		setContentView(R.layout.my_layout);

		progressH = (ProgressBar) findViewById(R.id.progressbar_horizon);
		progressC = (ProgressBar) findViewById(R.id.progressbar_circle);
		progressH.setVisibility(View.VISIBLE);

		mHandler = new Handler() {
			public void handleMessage(Message msg) {
				if (msg.what == CHANGE_PROGRESS) {
					progressH.setProgress(mProgress);
					progressC.setProgress(mProgress);
				} else {
					progressH.setProgress(View.GONE);
					progressC.setProgress(View.GONE);
					Toast.makeText(MainActivity.this, "This's it,100% now!",
							Toast.LENGTH_LONG).show();
				}
			}
		};

		new Thread() {
			public void run() {
				while (true) {
					mProgress = doSomething();
					Message msg = new Message();
					if (mProgress < 100) {
						msg.what = CHANGE_PROGRESS;
						mHandler.sendMessage(msg);
					} else {
						msg.what = FULL_PROGRESS;
						mHandler.sendMessage(msg);
						break;
					}
				}
			}

			private int doSomething() {
				mProgress += Math.random() * 10;
				try {
					Thread.sleep(200);
				} catch (InterruptedException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				return mProgress;
			}
		}.start();
	}

}
