package com.wilsonflying.testcontentresolver;


import com.wilsonflying.testcontenresolver.R;

import android.app.Activity;
import android.content.ContentResolver;
import android.database.Cursor;
import android.os.Bundle;
import android.provider.ContactsContract.CommonDataKinds.Phone;
//import android.provider.Contacts;//导入这个包是错的
import android.provider.ContactsContract.Contacts;//应该导入此包，否则contacts内容对应不上或者找不到
import android.widget.TextView;

public class MainActivity extends Activity {
//    private String[] columns = { Contacts._IDֵ
//            Contacts.DISPLAY_NAME,
//    };
    private String[] columns = {Contacts._ID, Contacts.DISPLAY_NAME};
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.layout_main);
		
		TextView tv = (TextView) findViewById(R.id.text1);
		tv.setText(getQueryData());
	}
	
	private String getQueryData(){
		StringBuilder sb = new StringBuilder();
		ContentResolver resolver = getContentResolver();
		Cursor cursor = resolver.query(Contacts.CONTENT_URI, null, null, null, null);
		while(cursor.moveToNext()){
			int idIndex = cursor.getColumnIndex(Contacts._ID);
			int displayIndex = cursor.getColumnIndex(Contacts.DISPLAY_NAME);
			
			int id = cursor.getInt(idIndex);
			String displayName = cursor.getString(displayIndex);
			
			Cursor cursor_phone = resolver.query(Phone.CONTENT_URI, null, Phone.CONTACT_ID+"="+id, null, null);//留意此处有个+id
			while(cursor_phone.moveToNext()){
				int phoneNumberIndex = cursor_phone.getColumnIndex(Phone.NUMBER);
				String phoneNumber = cursor_phone.getString(phoneNumberIndex);
				sb.append("id:"+id+" displayName:"+displayName + " phoneNumber:"+phoneNumber);
			}
		}		
		cursor.close();
		return sb.toString();
	}
}
